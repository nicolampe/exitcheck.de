import{j as e,L as g,R as $,a as W,I as z,S as Y,b as G,c as J,d as H,e as Z,r as u,u as X,f as _,C as q,g as T,h as U,i as E,k as Q,l as ee,B as R,A as se,m as te,n as re}from"./index-D8ushRMg.js";import{S as v}from"./skeleton-C1OIyrtY.js";function ae({question:s,onAnswer:x,currentAnswer:n}){var y,j,b;const f=t=>{x(s.id,t)},o=t=>{const h=t.target.value===""?"":Number(t.target.value);x(s.id,h)},w=(t,h)=>{var c;const p=Array.isArray(n)?n:[],d=((c=s.fields)==null?void 0:c.findIndex(S=>S.id===t))||0,N=[...p];N[d]=h,x(s.id,N)},i=t=>{x(s.id,t)};switch(s.type){case"select":return e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{htmlFor:s.id,children:s.text}),e.jsxs(Y,{value:n||"",onValueChange:f,children:[e.jsx(G,{id:s.id,className:"w-full",children:e.jsx(J,{placeholder:"Bitte auswählen"})}),e.jsx(H,{children:(y=s.options)==null?void 0:y.map(t=>e.jsx(Z,{value:String(t.value),children:t.label},t.value))})]}),s.helperText&&e.jsx("p",{className:"text-sm text-gray-500",children:s.helperText})]});case"number":return e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{htmlFor:s.id,children:s.text}),e.jsx(z,{id:s.id,type:"number",min:s.min,max:s.max,step:s.step||1,placeholder:s.placeholder,value:n===void 0?"":n,onChange:o,className:"w-full"}),s.helperText&&e.jsx("p",{className:"text-sm text-gray-500",children:s.helperText})]});case"multiNumber":return e.jsxs("div",{className:"space-y-3",children:[e.jsx(g,{children:s.text}),e.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:(j=s.fields)==null?void 0:j.map((t,h)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:t.id,children:t.label}),e.jsx(z,{id:t.id,type:"number",min:0,step:1e3,placeholder:t.placeholder,value:Array.isArray(n)&&n[h]!==void 0?n[h]:"",onChange:p=>{const d=p.target.value===""?"":Number(p.target.value);w(t.id,d)},className:"w-full"})]},t.id))})]});case"qualityFactor":return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{className:"text-base font-medium",children:s.text}),s.description&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:s.description})]}),e.jsx($,{value:n!==void 0?String(n):void 0,onValueChange:t=>i(parseFloat(t)),className:"space-y-3 pt-2",children:(b=s.options)==null?void 0:b.map(t=>e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(W,{value:String(t.value),id:`${s.id}-${t.value}`,className:"mt-1"}),e.jsx(g,{htmlFor:`${s.id}-${t.value}`,className:"font-normal",children:t.label})]},t.value))})]});default:return e.jsxs("div",{children:["Nicht unterstützter Fragetyp: ",s.type]})}}function ne(){const[s,x]=u.useState("questions"),[n,f]=u.useState(0),[o,w]=u.useState([]),[i,y]=u.useState({}),[j,b]=u.useState(!0),[t,h]=u.useState(null),[p,d]=u.useState(!1),[,N]=X(),{toast:c}=_();u.useEffect(()=>{(async()=>{try{const l=await(await fetch("/api/experto/questionnaire")).json();w(l.questions),b(!1)}catch(a){console.error("Fehler beim Laden der Fragen:",a),c({title:"Fehler",description:"Die Fragen konnten nicht geladen werden. Bitte versuchen Sie es später erneut.",variant:"destructive"}),b(!1)}})()},[c]);const S=(r,a)=>{y(l=>({...l,[r]:a}))},A=()=>{n<o.length-1?f(n+1):V()},D=()=>{n>0&&f(n-1)},P=()=>{var l;const r=o[n];if(!r)return!1;const a=i[r.id];return a===void 0||a===""?!1:r.type==="multiNumber"?Array.isArray(a)&&a.length===(((l=r.fields)==null?void 0:l.length)||0)&&a.every(m=>m!==void 0&&m!==""):!0},k=()=>{try{console.log("Raw answers:",i);const r=i.industry,a=Number(i.yearlyRevenue),l=Number(i.executiveSalary),m=Number(i.debt),B=Number(i.nonOperationalAssets),C=Array.isArray(i.lastThreeYearsProfit)?i.lastThreeYearsProfit.map(Number):[],F={};return Object.entries(i).forEach(([I,O])=>{if(I.startsWith("qualityFactors.")){const K=I.replace("qualityFactors.","");F[K]=Number(O)}}),console.log("Processed answers:",{industry:r,yearlyRevenue:a,lastThreeYearsProfit:C,executiveSalary:l,debt:m,nonOperationalAssets:B,qualityFactors:F}),{industry:r,yearlyRevenue:a,lastThreeYearsProfit:C,executiveSalary:l,debt:m,nonOperationalAssets:B,qualityFactors:F}}catch(r){return console.error("Fehler bei der Verarbeitung der Antworten:",r),null}},V=async()=>{try{d(!0);const r=k();if(!r||!r.industry||isNaN(r.yearlyRevenue)||r.lastThreeYearsProfit.length!==3||r.lastThreeYearsProfit.some(isNaN)||isNaN(r.executiveSalary)||isNaN(r.debt)||isNaN(r.nonOperationalAssets)||Object.keys(r.qualityFactors).length<6){c({title:"Unvollständige Daten",description:"Bitte beantworten Sie alle Fragen, um eine Berechnung durchzuführen.",variant:"destructive"}),d(!1);return}const l=await(await fetch("/api/experto/calculate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:r})})).json();l.success?(h(l.result),x("lead")):c({title:"Fehler",description:l.error||"Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.",variant:"destructive"})}catch(r){console.error("Fehler bei der Berechnung:",r),c({title:"Fehler",description:"Die Berechnung konnte nicht durchgeführt werden. Bitte versuchen Sie es später erneut.",variant:"destructive"})}finally{d(!1)}},L=async r=>{try{d(!0);const a=k();if(!t){c({title:"Fehler",description:"Unvollständige Daten. Bitte starten Sie den Prozess erneut.",variant:"destructive"});return}const m=await(await fetch("/api/experto/submit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({answers:a,leadData:r})})).json();m.success?N(`/unternehmenswert/${m.result.id}`):c({title:"Fehler",description:m.error||"Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.",variant:"destructive"})}catch(a){console.error("Fehler beim Absenden der Daten:",a),c({title:"Fehler",description:"Die Daten konnten nicht übermittelt werden. Bitte versuchen Sie es später erneut.",variant:"destructive"})}finally{d(!1)}},M=()=>{var r;if(j)return e.jsxs("div",{className:"space-y-4",children:[e.jsx(v,{className:"h-8 w-3/4"}),e.jsx(v,{className:"h-4 w-full"}),e.jsx(v,{className:"h-24 w-full"}),e.jsx(v,{className:"h-10 w-1/3"})]});if(s==="questions"){const a=o[n];return a?e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-2 sm:pb-4",children:[e.jsx(U,{className:"text-lg sm:text-xl text-gray-900",children:"Unternehmenswert-Berechnung"}),e.jsx(E,{className:"text-sm mt-1",children:"Beantworten Sie die folgenden Fragen für eine präzise Bewertung Ihres Unternehmens."})]}),e.jsx(Q,{className:"px-4 sm:px-6 pb-3 sm:pb-5",children:e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"text-xs sm:text-sm font-medium text-gray-500",children:["Frage ",n+1," von ",o.length]}),e.jsx("div",{className:"bg-gray-100 h-2 rounded-full flex-grow max-w-[60%] ml-4",children:e.jsx("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:`${(n+1)/o.length*100}%`}})})]}),e.jsx(ae,{question:a,onAnswer:S,currentAnswer:i[a.id]})]})}),e.jsxs(ee,{className:"flex justify-between px-4 sm:px-6 py-4 sm:py-5 border-t",children:[e.jsxs(R,{variant:"outline",size:"sm",className:"h-9 px-3 sm:h-10 sm:px-4",onClick:D,disabled:n===0,children:[e.jsx(se,{className:"mr-1 sm:mr-2 h-3 w-3 sm:h-4 sm:w-4"})," Zurück"]}),e.jsx(R,{size:"sm",className:"h-9 px-3 sm:h-10 sm:px-4 font-medium",onClick:A,disabled:!P()||p,children:n<o.length-1?e.jsxs(e.Fragment,{children:["Weiter ",e.jsx(te,{className:"ml-1 sm:ml-2 h-3 w-3 sm:h-4 sm:w-4"})]}):"Berechnen"})]})]}):null}if(s==="lead")return e.jsxs(e.Fragment,{children:[e.jsxs(T,{className:"px-4 sm:px-6 pt-4 sm:pt-6 pb-3 sm:pb-4",children:[e.jsx(U,{className:"text-lg sm:text-xl text-gray-900",children:"Ihr Unternehmenswert ist bereit!"}),e.jsx(E,{className:"text-sm mt-1",children:"Füllen Sie Ihre Kontaktdaten aus, um Ihren detaillierten Bewertungsbericht zu erhalten."})]}),e.jsxs(Q,{className:"px-4 sm:px-6 pb-5",children:[t&&e.jsxs("div",{className:"mb-6 p-4 sm:p-5 bg-gray-50 rounded-lg border border-gray-100 shadow-sm",children:[e.jsx("h3",{className:"text-base sm:text-lg font-medium mb-3 text-gray-800",children:"Ihr Unternehmenswert:"}),e.jsx("p",{className:"text-2xl sm:text-3xl font-bold text-primary",children:new Intl.NumberFormat("de-DE",{style:"currency",currency:"EUR",maximumFractionDigits:0}).format(t.companyValue)}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("strong",{children:"Branche:"})," ",t.industry]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[e.jsx("strong",{children:"Multiplikator:"})," ",(r=t.multiplier)==null?void 0:r.toFixed(2),"x"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg",children:[e.jsx("h3",{className:"text-base font-medium mb-3 text-gray-800",children:"Kontaktdaten für Ihren Bericht"}),e.jsx(re,{onSubmit:L,isSubmitting:p,onBack:()=>x("questions")})]})]})]})};return e.jsx(q,{className:"w-full max-w-3xl mx-auto",children:M()})}function ce(){return e.jsxs("div",{className:"container max-w-5xl mx-auto px-4 sm:px-6 py-8 sm:py-12",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[e.jsx("h1",{className:"text-2xl sm:text-3xl md:text-4xl font-bold tracking-tight text-gray-900 mb-3",children:"Unternehmenswert-Berechnung"}),e.jsx("p",{className:"text-base sm:text-lg text-gray-600 max-w-2xl mx-auto",children:"Ermitteln Sie den aktuellen Marktwert Ihres Unternehmens mit unserer präzisen Bewertungsmethode. In nur 3 Minuten zu Ihrer professionellen Wertanalyse."})]}),e.jsx("div",{className:"mb-10 sm:mb-16",children:e.jsx(ne,{})}),e.jsxs("div",{className:"bg-gray-50 rounded-xl p-6 sm:p-8 mt-10 sm:mt-12",children:[e.jsx("h2",{className:"text-xl sm:text-2xl font-bold mb-4 sm:mb-6 text-gray-900",children:"Unsere Bewertungsmethode"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-5 shadow-sm",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2 text-gray-900",children:"Multiplikator-Verfahren"}),e.jsx("p",{className:"text-gray-700 text-sm sm:text-base",children:"Das Multiplikator-Verfahren ist eine anerkannte, marktorientierte Bewertungsmethode, die auf dem Vergleich mit vergleichbaren Unternehmen basiert. Branchenspezifische Faktoren werden mit dem normalisierten EBIT multipliziert, um einen präzisen Unternehmenswert zu ermitteln."})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 shadow-sm",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2 text-gray-900",children:"Qualitätsfaktoren"}),e.jsx("p",{className:"text-gray-700 text-sm sm:text-base",children:"Neben Branchenfaktoren berücksichtigen wir individuelle Qualitätsmerkmale Ihres Unternehmens: Kundenstruktur, wiederkehrende Umsätze, Management-Struktur, Wachstumsrate, Profitabilität und Marktposition werden präzise einbezogen, um Ihren spezifischen Wert zu bestimmen."})]}),e.jsxs("div",{className:"bg-white rounded-lg p-5 shadow-sm",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-semibold mb-2 text-gray-900",children:"Realistischer Kaufpreis"}),e.jsx("p",{className:"text-gray-700 text-sm sm:text-base",children:"Der finale Kaufpreis berücksichtigt neben dem Basiswert auch finanzielle Faktoren wie Unternehmensschulden und nicht betriebsnotwendige Vermögenswerte. Diese umfassende Analyse liefert Ihnen eine fundierte Einschätzung des tatsächlichen Marktwerts Ihres Unternehmens."})]})]})]})]})}export{ce as default};
